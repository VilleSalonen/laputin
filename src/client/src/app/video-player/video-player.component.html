<div class="container" style="padding: 24px;">
    <div class="column" style="flex-grow: 1; margin-right: 24px;">
        <div class="row" style="background: black; flex-grow: 1; position: relative; background-repeat: no-repeat; background-size: contain; background-position: center;"
            [ngStyle]="!playbackHasBeenStarted && {'background-image': 'url(/laputin/thumbs/' + file.hash + '.jpg)'}">
            <div [ngClass]="{ 'hidden': playing }" class="filename" style="color: white;">
                <span class="filename-small">{{file.directory()}}</span>
                <br />
                <span class="filename-big">{{file.nameSansSuffix()}}</span>
                <span class="filename-small">{{file.suffix()}}</span>
            </div>

            <div [ngClass]="{ 'hidden': playbackHasBeenStarted }" class="video-hero-play" (click)="play()" *ngIf="!playing">
                <i class="far fa-play-circle" aria-hidden="true"></i>
            </div>

            <div [ngClass]="{ 'hidden': !playbackHasBeenStarted }" class="video-container">
                <video src="{{videoSource}}" #player></video>
            </div>
        </div>

        <div class="player-controls">
            <div class="player-main-button">
                <div *ngIf="!playing" (click)="play()">
                    <i class="fa fa-play" aria-hidden="true"></i>
                </div>
                <div *ngIf="playing" (click)="pause()">
                    <i class="fa fa-pause" aria-hidden="true"></i>
                </div>
            </div>

            <div class="timeline-and-buttons">
                <mat-slider [min]="sliderMin" [max]="sliderMax" [value]="sliderValue" (change)="setProgress($event)"></mat-slider>

                <div style="display: flex; flex-direction: row;">
                    <div (click)="random = !random" [ngClass]="{'active-button': random}" style="margin-right: 0.5em;">
                        <i class="fa fa-random" aria-hidden="true"></i>
                    </div>
                    <div (click)="goToPrevious()" style="margin-right: 0.5em;">
                        <i class="fa fa-fast-backward" aria-hidden="true"></i>
                    </div>
                    <div (click)="goToNext()" style="margin-right: 0.5em;">
                        <i class="fa fa-fast-forward" aria-hidden="true"></i>
                    </div>

                    <span>{{progressText}}</span>
                </div>
            </div>

            <div class="player-main-button">
                <div (click)="toggleFullScreen()">
                    <i class="fa fa-arrows-alt" aria-hidden="true"></i>
                </div>
            </div>
        </div>

        <div class="tagging" style="padding-top: 0; min-height: 150px;">
            <div style="display: flex; flex-direction: row;" style="margin-right: 0.5em;">
                <a (click)="playbackHasBeenStarted && screenshot()" title="Set screenshot" style="cursor: pointer;">
                    <i class="fa fa-camera" aria-hidden="true"></i>
                </a>
                <a (click)="openFile()" title="Open in external player" style="margin-right: 0.5em;" style="cursor: pointer;">
                    <i class="fa fa-film" aria-hidden="true"></i>
                </a>
                <a (click)="copy()" title="Copy tags" style="margin-right: 0.5em;" style="cursor: pointer;">
                    <i class="fa fa-copy" aria-hidden="true"></i>
                </a>
                <a (click)="paste()" title="Paste tags" style="margin-right: 0.5em;" style="cursor: pointer;">
                    <i class="fa fa-paste" aria-hidden="true"></i>
                </a>
            </div>

            <div class="row">
                <div class="tag-tools">
                    <app-tag-autocomplete [tagContainer]="file" (tagSelected)="addTag($event)" [type]="AutocompleteType.FileTagging"></app-tag-autocomplete>

                    <span *ngIf="selectedScreenshotTag">{{ selectedScreenshotTag.name }}</span>
                    <a (click)="playbackHasBeenStarted && selectedScreenshotTag && screenshotTag()" title="Set screenshot for tag"
                        style="cursor: pointer;">
                        <i class="fa fa-camera" aria-hidden="true"></i>
                    </a>
                    <app-tag-autocomplete [tagContainer]="file" (tagSelected)="selectScreenshotTag($event)" [type]="AutocompleteType.FileTimecodeTagging"></app-tag-autocomplete>
                </div>

                <div class="tags">
                    <button class="tag" *ngFor="let tag of file.tags" (click)="removeTag(tag)" mat-flat-button title="Click to remove {{tag.name}}">{{tag.name}}</button>
                </div>
            </div>
        </div>
    </div>

    <div class="column" style="min-width: 500px;">
        <div style="margin-bottom: 24px;">
            <div class="row" style="margin-bottom: 6px; flex-wrap: wrap;" *ngIf="selectedTagsForTimecode">
                <button class="tag" *ngFor="let tag of selectedTagsForTimecode" (click)="removeTagSelectionFromTimecode(tag)"
                    mat-flat-button title="Click to reset tag selection">{{tag.name}}</button>
            </div>

            <div class="row" style="margin-bottom: 6px;">
                <app-tag-autocomplete [tagContainer]="file" [exclude]="selectedTagsForTimecode" (tagSelected)="addTagSelectionToTimecode($event)"
                    [type]="AutocompleteType.FileTimecodeTagging"></app-tag-autocomplete>
            </div>

            <div class="row" style="margin-bottom: 6px;">
                <button mat-mini-fab color="primary" (click)="setTagStart()" title="Set tag timecode start">
                    <i class="fas fa-stopwatch"></i>
                </button>
                <button mat-mini-fab color="primary" (click)="goToTagStart()" title="Go to tag timecode start">
                    <i class="far fa-dot-circle"></i>
                </button>

                <mat-form-field>
                    <input matInput placeholder="Start time" [(ngModel)]="tagStart" style="width: 6em;" />
                </mat-form-field>

                <button mat-mini-fab color="primary" (click)="moveStartTimeBackwardMore()" title="Move start time backward more">
                    <i class="fas fa-backward"></i>
                </button>
                <button mat-mini-fab color="primary" (click)="moveStartTimeBackward()" title="Move start time backward">
                    <i class="fas fa-caret-left"></i>
                </button>

                <button mat-mini-fab color="primary" (click)="moveStartTimeForward()" title="Move start time forward">
                    <i class="fas fa-caret-right"></i>
                </button>
                <button mat-mini-fab color="primary" (click)="moveStartTimeForwardMore()" title="Move start time forward more">
                    <i class="fas fa-forward"></i>
                </button>
            </div>

            <div class="row" style="margin-bottom: 6px;">
                <button mat-mini-fab color="primary" (click)="setTagEnd()" title="Set tag timecode end">
                    <i class="fas fa-stopwatch"></i>
                </button>
                <button mat-mini-fab color="primary" (click)="goToTagEnd()" title="Go to tag timecode end">
                    <i class="far fa-dot-circle"></i>
                </button>

                <mat-form-field>
                    <input matInput [(ngModel)]="tagEnd" placeholder="End time" style="width: 6em;" />
                </mat-form-field>

                <button mat-mini-fab color="primary" (click)="moveEndTimeBackwardMore()" title="Move end time backward more">
                    <i class="fas fa-backward"></i>
                </button>
                <button mat-mini-fab color="primary" (click)="moveEndTimeBackward()" title="Move end time backward">
                    <i class="fas fa-caret-left"></i>
                </button>

                <button mat-mini-fab color="primary" (click)="moveEndTimeForward()" title="Move end time forward">
                    <i class="fas fa-caret-right"></i>
                </button>
                <button mat-mini-fab color="primary" (click)="moveEndTimeForwardMore()" title="Move end time forward more">
                    <i class="fas fa-forward"></i>
                </button>
            </div>

            <button (click)="saveTagTimecode()" mat-button>Save</button>

            <p *ngIf="timecodes.length === 0">No timecodes yet</p>
        </div>

        <div style="flex-grow: 1; overflow-y: auto;" *ngIf="timecodes.length > 0">
            <div *ngFor="let timecode of timecodes" style="margin-bottom: 12px;">
                <app-timecode [file]="file" [timecode]="timecode" (removed)="removeTimecode($event)"></app-timecode>
            </div>
        </div>
    </div>
</div>
